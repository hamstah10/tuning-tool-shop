<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">
<f:layout name="Default" />

<f:section name="main">
    <div class="">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 m-0">
                <f:if condition="{product}">
                    <f:then>Produkt bearbeiten: {product.title}</f:then>
                    <f:else>Neues Produkt</f:else>
                </f:if>
            </h1>
            <f:link.action action="listProducts" class="btn btn-primary">← Zurück</f:link.action>
        </div>

        <form action="{f:uri.action(action: 'saveProduct')}" method="POST">
            <input type="hidden" name="product_uid" value="{product.uid}" />

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Grundinformationen</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label">Titel *</label>
                            <input type="text" id="title" name="title" class="form-control" value="{product.title}" required />
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="sku" class="form-label">Artikelnummer (SKU) *</label>
                            <input type="text" id="sku" name="sku" class="form-control" value="{product.sku}" required />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="headline" class="form-label">Überschrift</label>
                        <input type="text" id="headline" name="headline" class="form-control" placeholder="Überschrift eingeben" value="{product.headline}" />
                    </div>

                    <div class="mb-3">
                        <label for="short_description" class="form-label">Kurzbeschreibung</label>
                        <textarea id="short_description" name="short_description" class="form-control" rows="3">{product.shortDescription}</textarea>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Beschreibung</label>
                        <textarea id="description" name="description" class="form-control" rows="6">{product.description}</textarea>
                    </div>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Preise & Lager</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="price" class="form-label">Preis (€) *</label>
                            <input type="number" id="price" name="price" class="form-control" step="0.01" value="{product.price}" required />
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="special_price" class="form-label">Sonderpreis (€)</label>
                            <input type="number" id="special_price" name="special_price" class="form-control" step="0.01" value="{product.specialPrice}" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="stock" class="form-label">Lagerbestand</label>
                            <input type="number" id="stock" name="stock" class="form-control" value="{product.stock}" />
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="weight" class="form-label">Gewicht (kg)</label>
                            <input type="number" id="weight" name="weight" class="form-control" step="0.001" value="{product.weight}" />
                        </div>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" id="shipping_free" name="shipping_free" class="form-check-input" value="1" <f:if condition="{product.shippingFree}">checked</f:if> />
                        <label class="form-check-label" for="shipping_free">Versandkostenfrei</label>
                    </div>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Kategorien & Hersteller</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="manufacturer" class="form-label">Hersteller</label>
                        <select id="manufacturer" name="manufacturer" class="form-select">
                            <option value="">-- Keine --</option>
                            <f:for each="{manufacturers}" as="mfr">
                                <option value="{mfr.uid}" <f:if condition="{product.manufacturer.uid} == {mfr.uid}">selected</f:if>>
                                    {mfr.title}
                                </option>
                            </f:for>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Kategorien</label>
                        <div class="border rounded p-3">
                            <f:for each="{categories}" as="cat">
                                <div class="form-check">
                                    <input type="checkbox" id="cat_{cat.uid}" name="categories[]" class="form-check-input" value="{cat.uid}" <f:if condition="{cat.isSelected}">checked</f:if> />
                                    <label class="form-check-label" for="cat_{cat.uid}">{cat.title}</label>
                                </div>
                            </f:for>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Bilder</h5>
                </div>
                <div class="card-body">
                    <f:if condition="{product.images}">
                        <f:then>
                            <div class="row g-3">
                                <f:for each="{product.images}" as="image">
                                    <div class="col-md-3">
                                        <div class="card h-100">
                                            <img src="{image.originalResource.publicUrl}" class="card-img-top" alt="Produktbild" />
                                            <div class="card-body p-2">
                                                <small class="text-muted">{image.originalResource.name}</small>
                                            </div>
                                        </div>
                                    </div>
                                </f:for>
                            </div>
                        </f:then>
                        <f:else>
                            <p class="text-muted">Keine Bilder vorhanden</p>
                        </f:else>
                    </f:if>
                    <p class="small text-muted mt-2">Bilder können in der Backend-Verwaltung hinzugefügt werden.</p>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Videos</h5>
                </div>
                <div class="card-body">
                    <f:if condition="{product.videos}">
                        <f:then>
                            <div class="list-group list-group-flush">
                                <f:for each="{product.videos}" as="video">
                                    <div class="list-group-item">
                                        <h6 class="mb-1">{video.title}</h6>
                                        <code class="text-muted small">{video.url}</code>
                                    </div>
                                </f:for>
                            </div>
                        </f:then>
                        <f:else>
                            <p class="text-muted">Keine Videos vorhanden</p>
                        </f:else>
                    </f:if>
                    <p class="small text-muted mt-2">Videos können in der Backend-Verwaltung hinzugefügt werden.</p>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Dokumente</h5>
                </div>
                <div class="card-body">
                    <f:if condition="{product.documents}">
                        <f:then>
                            <div class="list-group list-group-flush">
                                <f:for each="{product.documents}" as="document">
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">{document.title}</h6>
                                            <code class="text-muted small">{document.file.originalResource.name}</code>
                                        </div>
                                        <a href="{document.file.originalResource.publicUrl}" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                    </div>
                                </f:for>
                            </div>
                        </f:then>
                        <f:else>
                            <p class="text-muted">Keine Dokumente vorhanden</p>
                        </f:else>
                    </f:if>
                    <p class="small text-muted mt-2">Dokumente können in der Backend-Verwaltung hinzugefügt werden.</p>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Links</h5>
                </div>
                <div class="card-body">
                    <f:if condition="{product.links}">
                        <f:then>
                            <div class="list-group list-group-flush">
                                <f:for each="{product.links}" as="link">
                                    <div class="list-group-item">
                                        <h6 class="mb-1">{link.title}</h6>
                                        <a href="{link.url}" target="_blank" class="text-decoration-none">{link.url}</a>
                                    </div>
                                </f:for>
                            </div>
                        </f:then>
                        <f:else>
                            <p class="text-muted">Keine Links vorhanden</p>
                        </f:else>
                    </f:if>
                    <p class="small text-muted mt-2">Links können in der Backend-Verwaltung hinzugefügt werden.</p>
                </div>
            </div>

            <div class="card mb-4 rounded-0 bg_gray_dark">
                <div class="card-header bg-dark rounded-0">
                    <h5 class="m-0">Status</h5>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input type="checkbox" id="is_active" name="is_active" class="form-check-input" value="1" <f:if condition="{product.isActive}">checked</f:if> />
                        <label class="form-check-label" for="is_active">Produkt ist aktiv</label>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2 mb-4">
                <button type="submit" class="btn btn-primary button">Speichern</button>
                <f:link.action action="listProducts" class="btn btn-secondary">Abbrechen</f:link.action>
            </div>
        </form>
    </div>
</f:section>
</html>
