<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default" />

<f:section name="main">
    <div class="container-fluid">
      

        <!-- Filter & Search -->
        <div class="row mb-0">
            <div class="col-12">
                
                   
                        <form method="post" action="" class="row g-3 align-items-end">
                            <div class="col-12 col-md-6 col-lg-3">
                                
                                <f:form.select name="category" id="category" options="{categories}" optionLabelField="title" optionValueField="uid" prependOptionLabel="Alle Kategorien" prependOptionValue="0" value="{selectedCategory}" class="form-select" />
                            </div>

                            <div class="col-12 col-md-6 col-lg-3">
                                
                                <f:form.select name="manufacturer" id="manufacturer" options="{manufacturers}" optionLabelField="title" optionValueField="uid" prependOptionLabel="Alle Hersteller" prependOptionValue="0" value="{selectedManufacturer}" class="form-select" />
                            </div>

                            <div class="col-12 col-md-6 col-lg-3">
                                
                                <f:form.select name="sortBy" id="sortBy" options="{sortOptions}" value="{selectedSort}" class="form-select" />
                            </div>

                            <div class="col-12 col-md-6 col-lg-3">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-funnel"></i> Filtern
                                </button>
                            </div>

                            <f:if condition="{selectedCategory} || {selectedManufacturer}">
                                <div class="col-12">
                                    <f:link.page class="btn btn-outline-secondary">Alle anzeigen</f:link.page>
                                </div>
                            </f:if>
                        </form>
                        <f:comment>
                        <form method="post" action="" class="row mt-3">
                            <div class="col-12 col-md-8">
                                <f:form.textfield name="search" placeholder="Produkt suchen..." class="form-control" />
                            </div>
                            <div class="col-12 col-md-4">
                                <button type="submit" class="btn btn-secondary w-100">
                                    <i class="bi bi-search"></i> Suchen
                                </button>
                            </div>
                        </form>
                        </f:comment>
                    
                
            </div>
        </div>

        <!-- Products -->
         <f:if condition="{products}">
             <f:then>
                 <!-- Grid Layout (Standard) -->
                 <f:if condition="{settings.listLayout} == 'grid'">
                     <div class="row g-4 mb-4">
                         <f:for each="{products}" as="product">
                             <div class="col-12 col-sm-6 col-lg-3 col-xl-3">
                                 <f:render partial="Product/Card" arguments="{product: product, detailPid: detailPid, cartPid: cartPid}" />
                             </div>
                         </f:for>
                     </div>
                 </f:if>

                 <!-- Grid Layout with Product Type Badge -->
                 <f:if condition="{settings.listLayout} == 'gridWithType'">
                     <div class="row g-4 mb-4">
                         <f:for each="{products}" as="product">
                             <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                                 <div class="position-relative">
                                     <!-- Starter Package Badge -->
                                     <f:if condition="{product.productType} == 'starter'">
                                         <f:then>
                                             <div class="position-absolute top-0 start-50 translate-middle-x" style="z-index: 10;">
                                                 <span class="badge bg-danger px-3 py-2">
                                                     <i class="bi bi-star-fill"></i> EMPFOHLEN
                                                 </span>
                                             </div>
                                             <!-- Card with Border for Starter Packages -->
                                             <div class="h-100 border-2 border-danger">
                                                 <f:render partial="Product/Card" arguments="{product: product, detailPid: detailPid, cartPid: cartPid}" />
                                             </div>
                                         </f:then>
                                         <f:else>
                                             <!-- Card without special Border -->
                                             <div class="h-100 border">
                                                 <f:render partial="Product/Card" arguments="{product: product, detailPid: detailPid, cartPid: cartPid}" />
                                             </div>
                                         </f:else>
                                     </f:if>
                                 </div>
                             </div>
                         </f:for>
                     </div>
                 </f:if>

                 <!-- List Layout -->
                 <f:if condition="{settings.listLayout} == 'list'">
                     <div class="table-responsive mb-4">
                         <table class="table table-hover align-middle">
                             <thead class="table-light">
                                 <tr>
                                     <th style="width: 50px;">Bild</th>
                                     <th>Produkt</th>
                                     <th style="width: 150px;">Kategorie</th>
                                     <th style="width: 100px;">Preis</th>
                                     <th style="width: 80px;">Bestand</th>
                                     <th style="width: 100px;">Aktionen</th>
                                 </tr>
                             </thead>
                             <tbody>
                                 <f:for each="{products}" as="product">
                                     <tr>
                                         <td>
                                             <f:if condition="{product.images.0}">
                                                 <f:then>
                                                     <f:image image="{product.images.0}" alt="{product.title}" width="40" height="40" style="object-fit: cover; border-radius: 4px;" />
                                                 </f:then>
                                                 <f:else>
                                                     <i class="bi bi-image"></i>
                                                 </f:else>
                                             </f:if>
                                         </td>
                                         <td>
                                             <f:link.action action="show" controller="Product" arguments="{product: product}" pageUid="{detailPid}" class="text-decoration-none">
                                                 <strong>{product.title}</strong>
                                             </f:link.action>
                                             <f:if condition="{product.productType} == 'starter'">
                                                 <br />
                                                 <span class="badge bg-success">Starter Paket</span>
                                             </f:if>
                                         </td>
                                         <td>
                                             <f:for each="{product.categories}" as="category" iteration="iter">
                                                 <f:if condition="{iter.isFirst}">
                                                     {category.title}
                                                 </f:if>
                                             </f:for>
                                         </td>
                                         <td>
                                             <f:if condition="{product.specialPrice}">
                                                 <f:then>
                                                     <del class="text-muted small">
                                                         <f:format.currency currencySign="€" decimalSeparator="," thousandsSeparator=".">{product.price}</f:format.currency>
                                                     </del>
                                                     <br />
                                                     <span class="text-danger fw-bold">
                                                         <f:format.currency currencySign="€" decimalSeparator="," thousandsSeparator=".">{product.specialPrice}</f:format.currency>
                                                     </span>
                                                 </f:then>
                                                 <f:else>
                                                     <span class="fw-bold">
                                                         <f:format.currency currencySign="€" decimalSeparator="," thousandsSeparator=".">{product.price}</f:format.currency>
                                                     </span>
                                                 </f:else>
                                             </f:if>
                                         </td>
                                         <td>
                                             <f:if condition="{product.stock} > 0">
                                                 <f:then>
                                                     <span class="badge bg-success">Lager: {product.stock}</span>
                                                 </f:then>
                                                 <f:else>
                                                     <span class="badge bg-danger">Nicht verfügbar</span>
                                                 </f:else>
                                             </f:if>
                                         </td>
                                         <td>
                                             <f:link.action action="show" controller="Product" arguments="{product: product}" pageUid="{detailPid}" class="btn btn-sm btn-outline-primary" title="Details">
                                                 <i class="bi bi-eye"></i>
                                             </f:link.action>
                                             <f:if condition="{product.stock} > 0">
                                                 <f:form action="add" controller="Cart" pluginName="Cart" pageUid="{cartPid}" arguments="{product: product.uid, quantity: 1}" class="d-inline">
                                                     <button type="submit" class="btn btn-sm btn-outline-success" title="In den Warenkorb">
                                                         <i class="bi bi-cart-plus"></i>
                                                     </button>
                                                 </f:form>
                                             </f:if>
                                         </td>
                                     </tr>
                                 </f:for>
                             </tbody>
                         </table>
                     </div>
                 </f:if>

                 <div class="row">
                     <div class="col-12">
                         <f:render partial="Pagination" arguments="{pagination: pagination, action: 'list', arguments: {category: selectedCategory, sortBy: selectedSort}}" />
                     </div>
                 </div>
             </f:then>
            <f:else>
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            <h4 class="alert-heading">Keine Produkte gefunden</h4>
                            <p>Versuchen Sie, die Filter anzupassen oder ein anderes Suchkriterium zu verwenden.</p>
                        </div>
                    </div>
                </div>
            </f:else>
        </f:if>
    </div>
</f:section>

</html>
